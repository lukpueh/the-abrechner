<head>
    <title>The Urlaubs Abrechnungs Machine</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link href='http://fonts.googleapis.com/css?family=Pathway+Gothic+One&subset=latin,latin-ext' rel='stylesheet' type='text/css'>

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css">


    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>
</head>

<template name="main">
    <div class="container">
        <div class="page-header text-center">
            <h1>
                <div class="row">
                    <div id="logo" class="col-xs-12 col-sm-6"><span class="glyphicon glyphicon-barcode"></span></div>
                    <div class="col-xs-12">The Urlaubs Abrechnungs Machine</div>
                </div>
            </h1>
        </div>
        <div class="page-body">
            {{> yield}}
        </div>
        <div class="page-footer text-center">Fellow designer's note: If you are a Russian, ruin your perfect friendship by using this tool!</div>
    </div>
</template>

<template name="home">
    <p class="lead">Who doesn't know this? What began as nice innocent holidays with beloved friends ends in distrust and even bloodshed
when it comes to partion of expenses. Well, suffer no more!
The days of broken friendships are over. All thanks to the Urlaubs Abrechnungs Machine. By the way, you can use this for other shared accounts too, yeah!
    </p>
    <form class="new-abrechner" method="post">
        <div class="form-group">

            <label>
                <span class="sr-only">Title</span>
                <input type="text" name="title" placeholder="Title">
            </label>
            <label>
                <span class="sr-only">Description (optional)</span>
                <textarea name="description" placeholder="Description (optional)"></textarea>
            </label>
            <input class="btn btn-default" type="submit" value="Create new Urlaubs Abrechner" >
        </div>
    </form>
</template>  

<template name="abrechner">
    <div class="well break text-center" id="issueUrl">
        <span class="btn-clipboard pointer">Select</span>
        You can access this page at {{urlFor 'abrechner'}}
    </div>

    <div class="text-center">
        <h2>{{title}}</h2>
        <p class="lead">{{description}}</p>
    </div>


    <h3>Add the people that share their expenses…</h3>
    <form class="new-person" method="post">
        <div class="form-group">
            <div class="row">
                <div class="col-sm-9">
                    <label><span class="sr-only">Person</span>
                    <input type="text" name="person" placeholder="Person" class="form-control">
                    </label>
                </div>
                <div class="col-sm-3">
                    <input class="btn btn-default padded-item-vertical" type="submit" value="Add">
                </div>
            </div>
        </div>
    </form>
        
    <div class="form-group">
    {{#each personsForAbrechnung}}
        <p class="padded-item-horizontal person"><span class="glyphicon glyphicon-user" aria-hidden="true"></span>{{name}} <span class="glyphicon glyphicon-remove delete-person text-danger pull-right pointer" aria-hidden="true"></span></p>
    {{/each}}
    </div>

    {{#if hasPersons}}
        <h3>Add the items that where bought and the payer…</h3>
        <form class="new-item" method="post">
            <div class="form-group">
                <div class="row">
                    <div class="col-sm-3">
                        <label>
                            <span class="sr-only">Title</span>
                            <input type="text" name="item" placeholder="Item" class="form-control">
                        </label>
                    </div>
                    <div class="col-sm-3">
                        <label>
                            <span class="sr-only">Costs</span>
                            <div class="input-group">
                                <span class="input-group-addon">&euro;</span>
                                <input type="text" name="amount" placeholder="Cost" class="form-control">
                            </div>
                        </label>
                    </div>
                    <div class="col-sm-3">
                        <label>
                            <span class="sr-only">Who paid</span>
                            <select name="person" class="form-control">
                            {{#each personsForAbrechnung}}
                                <option value="{{_id}}">{{name}}</option>
                            {{/each}}        
                            </select>
                        </label>
                    </div>
                    <div class="col-sm-3">
                        <input class="btn btn-default padded-item-vertical" type="submit" value="Add">
                    </div>
                </div>
            </div>
        </form>


        <div class="panel-group" role="tablist" aria-multiselectable="true">
        {{#each itemsForAbrechnung}}
            <div class="panel panel-default item">
                <div class="panel-heading" role="tab">
                    <a data-toggle="collapse" href="#itemColl{{_id}}" aria-expanded="false" aria-controls="itemColl{{_id}}">
                        <div class="item-inner">{{personNameById paidBy}} paid &euro; {{amount}} for '{{title}}'<span class="glyphicon glyphicon-remove delete-item text-danger pull-right pointer" aria-hidden="true"></span></div>
                    </a>
                </div>
                <div id="itemColl{{_id}}" class="panel-collapse collapse" role="tabpanel" aria-expanded="false">
                     <ul class="list-group">
                        {{#each shares}}
                            <li class="list-group-item">
                                <input class="pays-share" data-item-id="{{../_id}}" type="checkbox" name="pays" checked="{{pays}}">{{personNameById person}}
                            </li>
                        {{/each}}
                    </ul>
                </div>
            </div>     
        {{/each}}
        </div>
    {{/if}}
    {{#if hasItems}}
        <h3>Check out who's getting and who's paying...</h3>
        <div class="row">
            <div class="col-sm-12">
                <table id="breakdownTable" class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>name</th>
                            <th>account</th>
                            <th>wants to pay</th>
                            <th>has paid</th>
                        </tr>
                    </thead>
                    <tbody>
                    {{#each breakDown}}
                    <tr>
                        <td>{{name}}</td>
                        <td>&euro; {{diff}}</td>
                        <td>&euro; {{pays}}</td>
                        <td>&euro; {{paid}}</td>
                    </tr>
                    {{/each}}

                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="3" style="text-align:right">Total:</th>
                            <th></th>
                        </tr>
                    </tfoot>
                </table>
            </div>  
        </div>
        {{> raphael}}
    {{/if}}
    <button class="delete-abrechnung btn btn-danger">Delete Abrechnung</button>

</template>  
<template name="raphael">
    <div class="text-center">
        <div id="raphael-container"></div>
    </div>
</template>  
